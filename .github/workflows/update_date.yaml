---
name: Update date.txt
on: workflow_dispatch
jobs:
  test:
    runs-on: ubuntu-24.04
    timeout-minutes: 10
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          persist-credentials: false

      - id: date
        run: |
          date=$(date "+%Y%m%dT%H%M%S%Z")
          echo "$date" > date.txt
          echo "value=$date" >> "$GITHUB_OUTPUT"

      - uses: csm-actions/securefix-action@pr/123
        with:
          app_id: ${{vars.AUTOFIX_TRIGGER_APP_ID}}
          app_private_key: ${{secrets.AUTOFIX_TRIGGER_APP_PRIVATE_KEY}}
          server_repository: securefix-demo-server
          # repository: szksh-lab/securefix-demo-client
          branch: update-date-${{steps.date.outputs.value}}
          pull_request_title: Update date (${{steps.date.outputs.value}})
          pull_request_base_branch: main
          pull_request_body: |
            Update date (${{steps.date.outputs.value}})
            ${{github.server_url}}/${{github.repository}}/actions/runs/${{github.run_id}}
          pull_request_draft: true
          pull_request_assignees: |
            suzuki-shunsuke
          pull_request_reviewers: |
            suzuki-shunsuke
          pull_request_team_reviewers: |
            sre
          pull_request_labels: |
            enhancement
            yo
          pull_request_comment: |
            Please check it out.
